<!DOCTYPE html><html><head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-179068877-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-179068877-2');
</script>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width">
<title>さばえものづくり博覧会 マップ</title>
<link rel='stylesheet' href='https://code4sabae.github.io/leaflet-mjs/leaflet.css'/>
<script type="module">
    import util from "https://taisukef.github.io/util/util.mjs";
    import L from 'https://code4sabae.github.io/leaflet-mjs/leaflet.mjs'

    window.onload = async () => {
      const url = "https://push.sabae.cc/524.csv";
      const data = await util.fetchCSVtoJSON(url);
      
      // map
      const map = L.map('divmap');
      // set 国土地理院地図 https://maps.gsi.go.jp/development/ichiran.html
      L.tileLayer("https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png", {
        attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html">国土地理院</a>"',
        //maxZoom: 18,
        center: [35.94363, 136.188992],
        //zoom: 15,
      }).addTo(map);
      map.setView([35.961, 136.228], 12);
      
      let iconlayer = L.layerGroup();
      iconlayer.addTo(map);
      const lls = [];
      data.filter((d) => d.緯度 && d.経度).forEach((d) => {
        const ll = [ d.緯度, d.経度 ];
        //const fillColor = d.業種.indexOf("料飲") >= 0 ? "#BB4459" : (d.業種.indexOf("眼鏡") >= 0 ? "#48A0BE" : "#BBC459");
        const fillColor = d.業種.indexOf("料飲") >= 0 ? "#BB4459" : "#48A0BE";
        const marker = L.circleMarker(ll, { title: d.事業所名, fillColor, stroke: false, radius: 8, fillOpacity: 1 });
        marker.bindPopup(`<a href=detail.html#${d.id}>${d.事業所名}</a><br>${d.業種}</a>`);
        iconlayer.addLayer(marker);
        lls.push(ll);
      });
      
      /*
      if (lls.length) {
        map.fitBounds(lls);
      }
      */
    };
  </script>
<link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@300&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans+Condensed:wght@300&display=swap" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="style.css">
<script type="module" src="./footer.js"></script>
</head>
<body>

  
  <div id="divmap" style="height:88vh"></div>
  <smono-footer></smono-footer>

</body>
</html>
